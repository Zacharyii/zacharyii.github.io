<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>bjw群聊发言检测器</title>
  <style>
    /* 这里的 CSS 与原来完全相同，省略以节省篇幅 */
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei",sans-serif}
    body{background:#f4f6f9;padding:20px}
    .container{max-width:600px;margin:auto;background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.1)}
    .header{background:#4e6bff;color:#fff;padding:20px;text-align:center;font-size:1.3em}
    .input-area{padding:20px}
    textarea{width:100%;height:120px;padding:12px;border:2px solid #ddd;border-radius:12px;font-size:16px;resize:none}
    textarea:focus{border-color:#4e6bff;outline:none}
    .btn{margin-top:15px;width:100%;padding:14px;background:#4e6bff;color:#fff;border:none;border-radius:12px;font-size:18px;cursor:pointer}
    .btn:hover{background:#3a56d4}
    .btn.paste{background:#28a745;margin-top:8px}
    .btn.paste:hover{background:#218838}
    .result{margin-top:15px;padding:15px;border-radius:12px;font-weight:bold;text-align:center;line-height:1.6}
    .safe{background:#e6f7ee;color:#0aa95a;border:1px solid #0aa95a}
    .danger{background:#ffe6e6;color:#d32f2f;border:1px solid #d32f2f}
    .tips{font-size:12px;color:#888;margin-top:10px;text-align:center}
    .highlight{background:#ffeb3b;color:#333;padding:2px 6px;border-radius:4px;font-weight:bold}
    .stats{font-size:11px;color:#666;margin-top:8px}
  </style>
</head>
<body>

<div class="container">
  <div class="header">bjw群聊发言检测器</div>
  <div class="input-area">
    <textarea id="message" placeholder="粘贴你要发送的消息..."></textarea>
    <button class="btn" onclick="check()">立即检测</button>
    <button class="btn paste" onclick="pasteFromClipboard()">从剪贴板粘贴并检测</button>
    <div id="result"></div>
    <div class="tips">
      自动拦截 <span class="highlight">1500+</span> 种违禁词绕过写法（如 策 略、项 目、微 信、T G）
    </div>
    <div class="stats" id="stats">加载中…</div>
    <p style="font-size:12px;color:#666;margin-top:15px;">开发者：椰汁</p>
  </div>
</div>

<!-- 1. 先加载违禁词库 -->
<script src="banned.js"></script>

<script>
  // ---------- 检测入口 ----------
  function check() {
    const msg = document.getElementById('message').value.trim();
    const resultDiv = document.getElementById('result');

    if (!msg) {
      resultDiv.innerHTML = '<div class="result danger">请输入内容！</div>';
      return;
    }

    // 调用外部库
    window.checkBanned(msg, ({found}) => {
      if (found.length === 0) {
        resultDiv.innerHTML = '<div class="result safe">安全！可以发送</div>';
      } else {
        const highlighted = found.slice(0, 20)
          .map(w => `<span class="highlight">${escapeHtml(w)}</span>`)
          .join(' | ');
        const more = found.length > 20 ? ` 等 ${found.length} 项` : '';
        resultDiv.innerHTML = `
          <div class="result danger">
            检测到 ${found.length} 个违禁词：<br>${highlighted}${more}
          </div>`;
      }
    });
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // ---------- 剪贴板 ----------
  function pasteFromClipboard() {
    if (!navigator.clipboard) {
      alert('你的浏览器不支持剪贴板功能，请手动粘贴');
      return;
    }
    navigator.clipboard.readText()
      .then(text => {
        if (text && text.trim()) {
          document.getElementById('message').value = text.trim();
          check();
        } else {
          alert('剪贴板为空或无有效内容');
        }
      })
      .catch(() => {
        alert('无法读取剪贴板（需 HTTPS 或用户交互）\n请手动粘贴内容');
      });
  }

  // Ctrl+Enter 快捷键
  document.getElementById('message').addEventListener('keydown', e => {
    if (e.ctrlKey && e.key === 'Enter') check();
  });
</script>

</body>
</html>
